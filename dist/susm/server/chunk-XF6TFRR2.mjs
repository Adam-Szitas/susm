import './polyfills.server.mjs';
import{b as N,c as R}from"./chunk-X3H2QA4E.mjs";import{Aa as b,Ba as m,C as p,Ca as I,Fa as d,Ga as c,Gb as D,Kb as w,Lb as B,Q as n,W as y,fa as u,ga as f,p as h,pa as s,qa as r,ta as k,u as S,ua as M,v as O,wa as P,xa as _,xb as T,za as o}from"./chunk-43FWLFEJ.mjs";import{a as E,b as j}from"./chunk-N7QBYMCK.mjs";function V(t,i){t&1&&(s(0,"p"),o(1),d(2,"translate"),r()),t&2&&(n(),b(c(2,1,"share.loading")))}function A(t,i){if(t&1&&(s(0,"div",1),o(1),d(2,"translate"),r()),t&2){let e=_();n(),m(" ",c(2,1,e.loadError())," ")}}function L(t,i){if(t&1&&(s(0,"p",4),o(1),r()),t&2){let e,l=_(2);n(),m(" ",(e=l.object())==null?null:e.note," ")}}function F(t,i){t&1&&(o(0),d(1,"translate")),t&2&&m(" ",c(1,1,"share.alreadyVerified")," ")}function U(t,i){t&1&&(o(0),d(1,"translate")),t&2&&m(" ",c(1,1,"share.verifying")," ")}function $(t,i){t&1&&(o(0),d(1,"translate")),t&2&&m(" ",c(1,1,"share.markDone")," ")}function z(t,i){t&1&&(s(0,"p",8),o(1),d(2,"translate"),r()),t&2&&(n(),b(c(2,1,"share.success")))}function H(t,i){if(t&1&&(s(0,"p",1),o(1),d(2,"translate"),r()),t&2){let e=_(2);n(),b(c(2,1,e.actionError()))}}function K(t,i){if(t&1){let e=k();s(0,"div",2)(1,"h2"),o(2),r(),s(3,"p",3),o(4),r(),u(5,L,2,1,"p",4),s(6,"p",5),o(7),d(8,"translate"),r()(),s(9,"div",6)(10,"button",7),P("click",function(){S(e);let g=_();return O(g.confirmWork())}),u(11,F,2,3)(12,U,2,3)(13,$,2,3),r()(),u(14,z,3,3,"p",8),u(15,H,3,3,"p",1)}if(t&2){let e,l,g,x,C,v,a=_();n(2),b((e=a.object())==null?null:e.project_name),n(2),m(" ",(l=a.object())==null||l.address==null?null:l.address.street," "),n(),f((g=a.object())!=null&&g.note?5:-1),n(2),I(" ",c(8,9,"share.currentStatus"),": ",a.formatStatus(((x=a.object())==null?null:x.status)||a.defaultStatus)," "),n(3),M("disabled",a.verifying()||((C=a.object())==null?null:C.status)==="verified"),n(),f(((v=a.object())==null?null:v.status)==="verified"?11:a.verifying()?12:13),n(3),f(a.success()?14:-1),n(),f(a.actionError()?15:-1)}}var W=class t{#e=h(T);#t=h(D);formatStatus=R;defaultStatus=N;object=p(null);loading=p(!0);verifying=p(!1);loadError=p(null);actionError=p(null);success=p(!1);token;ngOnInit(){if(this.token=this.#e.snapshot.paramMap.get("token")??"",!this.token){this.loadError.set("share.errors.invalidLink"),this.loading.set(!1);return}this.loadObject()}loadObject(){this.loading.set(!0),this.loadError.set(null),this.#t.get(`public/object/${this.token}`).subscribe({next:i=>{this.object.set(i),this.loading.set(!1)},error:()=>{this.loadError.set("share.errors.invalidLink"),this.loading.set(!1)}})}confirmWork(){this.verifying()||!this.object()||(this.verifying.set(!0),this.#t.post(`public/object/${this.token}/verify`,{}).subscribe({next:i=>{let e=this.object();e&&this.object.set(j(E({},e),{status:i.status})),this.verifying.set(!1),this.success.set(!0),this.actionError.set(null)},error:()=>{this.verifying.set(!1),this.actionError.set("share.errors.verifyFailed")}}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-object-share"]],decls:7,vars:4,consts:[[1,"share-wrapper"],[1,"error"],[1,"card"],[1,"address"],[1,"note"],[1,"status"],[1,"actions"],["type","button",1,"primary",3,"click","disabled"],[1,"success"]],template:function(e,l){e&1&&(s(0,"div",0)(1,"h1"),o(2),d(3,"translate"),r(),u(4,V,3,3,"p")(5,A,3,3,"div",1)(6,K,16,11),r()),e&2&&(n(2),b(c(3,2,"share.title")),n(2),f(l.loading()?4:l.loadError()?5:l.object()?6:-1))},dependencies:[B,w],styles:[".share-wrapper[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;background:#f7f7f7;text-align:center}h1[_ngcontent-%COMP%]{margin-bottom:1.5rem}.card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:16px;box-shadow:0 10px 30px #00000014;margin-bottom:2rem;max-width:420px;width:100%}.address[_ngcontent-%COMP%]{margin:0 0 1rem;color:#555}.note[_ngcontent-%COMP%]{font-style:italic;color:#333}.status[_ngcontent-%COMP%]{margin-top:1rem;font-weight:600}.error[_ngcontent-%COMP%]{color:#b10e0e;background:#fdeaea;padding:1rem 1.5rem;border-radius:8px}.success[_ngcontent-%COMP%]{color:#0f8a00;background:#e3f5e1;padding:.75rem 1.25rem;border-radius:8px}.actions[_ngcontent-%COMP%]{margin-top:1.5rem}button.primary[_ngcontent-%COMP%]{padding:.85rem 2rem;border:none;border-radius:999px;background:#111;color:#fff;font-size:1rem;cursor:pointer;transition:opacity .2s ease}button.primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:default}"],changeDetection:0})};export{W as ObjectShareComponent};
