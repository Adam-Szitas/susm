import './polyfills.server.mjs';
import{a as D,b as G}from"./chunk-WFXO5QVN.mjs";import{a as Y,b as H,c as k,d as J,e as K,h as Q,j as U,k as W,l as X,m as Z,n as ee,o as te,p as oe,q as ne,r as ie}from"./chunk-AFDRFLQU.mjs";import{a as B}from"./chunk-LME27552.mjs";import{Aa as d,Ba as f,C as M,Ca as q,Da as j,Fa as i,Fb as w,Ga as r,Kb as I,Lb as N,Q as o,W as E,db as R,eb as F,fa as u,ga as C,ha as L,ia as z,ja as b,ka as h,la as v,ma as c,na as l,oa as P,p as _,pa as g,qa as s,ta as S,u as T,v as y,va as O,wa as $,xa as x,za as a}from"./chunk-43FWLFEJ.mjs";import"./chunk-N7QBYMCK.mjs";function me(e,t){e&1&&(c(0,"span",5),a(1),i(2,"translate"),l()),e&2&&(o(),d(r(2,1,"protocols.nameRequired")))}function ce(e,t){if(e&1&&(c(0,"option",22),a(1),i(2,"translate"),l()),e&2){let n=t.$implicit;v("value",n),o(),d(r(2,2,"protocols.fieldTypes."+n))}}function de(e,t){e&1&&(c(0,"div",2)(1,"label"),a(2),i(3,"translate"),l(),P(4,"input",26),l()),e&2&&(o(2),d(r(3,1,"protocols.customFieldName")))}function se(e,t){if(e&1){let n=S();c(0,"div",16)(1,"div",19)(2,"div",2)(3,"label"),a(4),i(5,"translate"),l(),P(6,"input",20),l(),c(7,"div",2)(8,"label"),a(9),i(10,"translate"),l(),c(11,"select",21),b(12,ce,3,4,"option",22,z),l()(),u(14,de,5,3,"div",2),c(15,"div",23)(16,"label"),P(17,"input",24),a(18),i(19,"translate"),l()(),c(20,"button",25),O("click",function(){let p=T(n).$index,A=x();return y(A.removeField(p))}),a(21),i(22,"translate"),l()()()}if(e&2){let n=t.$implicit,m=t.$index,p=x();v("formGroupName",m),o(4),f("",r(5,6,"protocols.fieldLabel")," *"),o(5),f("",r(10,8,"protocols.fieldType")," *"),o(3),h(p.fieldTypes),o(2),C(p.isCustomField(n)?14:-1),o(4),f(" ",r(19,10,"protocols.required")," "),o(3),f(" ",r(22,12,"protocols.remove")," ")}}function fe(e,t){e&1&&(a(0),i(1,"translate")),e&2&&f(" ",r(1,1,"protocols.saving")," ")}function _e(e,t){e&1&&(a(0),i(1,"translate")),e&2&&f(" ",r(1,1,"protocols.create")," ")}var ge=["text","number","date","address","status","note","custom"],V=class e{#e=_(ne);#n=_(G);#o=_(D);#t=_(w);#i=_(B);form;fieldTypes=ge;saving=M(!1);constructor(){this.form=this.#e.group({name:["",[k.required]],description:[""],header_template:[""],footer_template:[""],fields:this.#e.array([])})}get fields(){return this.form.get("fields")}addField(){let t=this.#e.group({label:["",[k.required]],field_type:["text",[k.required]],required:[!1],order:[this.fields.length],custom_field_name:[""]});this.fields.push(t)}removeField(t){this.fields.removeAt(t),this.fields.controls.forEach((n,m)=>{n.patchValue({order:m})})}getFieldType(t){return t.get("field_type")?.value||"text"}isCustomField(t){return this.getFieldType(t)==="custom"}onSubmit(){if(this.form.invalid){this.#t.showError(this.#i.instant("protocols.formInvalid"));return}this.saving.set(!0);let t=this.form.value,n=t.fields.map(p=>{let A=p.field_type==="custom"&&p.custom_field_name?"custom":p.field_type;return{label:p.label,field_type:A,required:p.required||!1,order:p.order||0}}),m={name:t.name,description:t.description||void 0,fields:n,header_template:t.header_template||void 0,footer_template:t.footer_template||void 0};this.#n.createTemplate(m).subscribe({next:()=>{this.#t.showSuccess(this.#i.instant("protocols.templateCreated")),this.saving.set(!1),this.#o.close()},error:p=>{this.#t.showError(p.message||this.#i.instant("protocols.createFailed")),this.saving.set(!1)}})}close(){this.#o.close()}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=E({type:e,selectors:[["app-protocol-template-modal"]],decls:46,vars:36,consts:[[1,"protocol-template-form"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","name"],["type","text","id","name","formControlName","name"],[1,"error"],["for","description"],["id","description","formControlName","description","rows","3"],["for","header_template"],["id","header_template","formControlName","header_template","rows","2",3,"placeholder"],["for","footer_template"],["id","footer_template","formControlName","footer_template","rows","2",3,"placeholder"],[1,"fields-section"],[1,"fields-header"],["type","button",1,"btn","btn-secondary",3,"click"],["formArrayName","fields",1,"fields-list"],[1,"field-item",3,"formGroupName"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"field-row"],["type","text","formControlName","label"],["formControlName","field_type"],[3,"value"],[1,"form-group","checkbox-group"],["type","checkbox","formControlName","required"],["type","button",1,"btn","btn-danger","btn-small",3,"click"],["type","text","formControlName","custom_field_name"]],template:function(n,m){if(n&1&&(c(0,"div",0)(1,"h2"),a(2),i(3,"translate"),l(),c(4,"form",1),O("ngSubmit",function(){return m.onSubmit()}),c(5,"div",2)(6,"label",3),a(7),i(8,"translate"),l(),P(9,"input",4),u(10,me,3,3,"span",5),l(),c(11,"div",2)(12,"label",6),a(13),i(14,"translate"),l(),P(15,"textarea",7),l(),c(16,"div",2)(17,"label",8),a(18),i(19,"translate"),l(),P(20,"textarea",9),i(21,"translate"),l(),c(22,"div",2)(23,"label",10),a(24),i(25,"translate"),l(),P(26,"textarea",11),i(27,"translate"),l(),c(28,"div",12)(29,"div",13)(30,"h3"),a(31),i(32,"translate"),l(),c(33,"button",14),O("click",function(){return m.addField()}),a(34),i(35,"translate"),l()(),c(36,"div",15),b(37,se,23,14,"div",16,L),l()(),c(39,"div",17)(40,"button",14),O("click",function(){return m.close()}),a(41),i(42,"translate"),l(),c(43,"button",18),u(44,fe,2,3)(45,_e,2,3),l()()()()),n&2){let p;o(2),d(r(3,16,"protocols.createTemplate")),o(2),v("formGroup",m.form),o(3),f("",r(8,18,"protocols.templateName")," *"),o(3),C((p=m.form.get("name"))!=null&&p.invalid&&((p=m.form.get("name"))!=null&&p.touched)?10:-1),o(3),d(r(14,20,"protocols.description")),o(5),d(r(19,22,"protocols.headerTemplate")),o(2),v("placeholder",j(r(21,24,"protocols.headerPlaceholder"))),o(4),d(r(25,26,"protocols.footerTemplate")),o(2),v("placeholder",j(r(27,28,"protocols.footerPlaceholder"))),o(5),d(r(32,30,"protocols.fields")),o(3),f(" ",r(35,32,"protocols.addField")," "),o(3),h(m.fields.controls),o(4),f(" ",r(42,34,"common.cancel")," "),o(2),v("disabled",m.saving()||m.form.invalid),o(),C(m.saving()?44:45)}},dependencies:[F,ie,Q,te,oe,H,Y,ee,J,K,U,Z,W,X,N,I],styles:[".protocol-template-form[_ngcontent-%COMP%]{padding:2rem;max-width:800px;max-height:90vh;overflow-y:auto}.protocol-template-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1.5rem}.protocol-template-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.protocol-template-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.protocol-template-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .protocol-template-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .protocol-template-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}.protocol-template-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:#d32f2f;font-size:.875rem;display:block;margin-top:.25rem}.protocol-template-form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer}.protocol-template-form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto}.protocol-template-form[_ngcontent-%COMP%]   .fields-section[_ngcontent-%COMP%]{margin-top:2rem;padding-top:2rem;border-top:1px solid #ddd}.protocol-template-form[_ngcontent-%COMP%]   .fields-section[_ngcontent-%COMP%]   .fields-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.protocol-template-form[_ngcontent-%COMP%]   .fields-section[_ngcontent-%COMP%]   .fields-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.protocol-template-form[_ngcontent-%COMP%]   .fields-section[_ngcontent-%COMP%]   .fields-list[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid #e0e0e0;border-radius:4px;margin-bottom:1rem;background:#f9f9f9}.protocol-template-form[_ngcontent-%COMP%]   .fields-section[_ngcontent-%COMP%]   .fields-list[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]   .field-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1.5fr 1.5fr auto auto;gap:1rem;align-items:end}@media (max-width: 768px){.protocol-template-form[_ngcontent-%COMP%]   .fields-section[_ngcontent-%COMP%]   .fields-list[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]   .field-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.protocol-template-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem;padding-top:1rem;border-top:1px solid #ddd}"]})};var ue=(e,t)=>t._id==null?null:t._id.$oid;function Ce(e,t){e&1&&(g(0,"p"),a(1),i(2,"translate"),s()),e&2&&(o(),d(r(2,1,"protocols.loading")))}function Pe(e,t){if(e&1){let n=S();g(0,"div",3)(1,"p"),a(2),i(3,"translate"),s(),g(4,"button",2),$("click",function(){T(n);let p=x();return y(p.createTemplate())}),a(5),i(6,"translate"),s()()}e&2&&(o(2),d(r(3,2,"protocols.noTemplates")),o(3),f(" ",r(6,4,"protocols.createFirstTemplate")," "))}function xe(e,t){if(e&1&&(g(0,"p",6),a(1),s()),e&2){let n=x().$implicit;o(),d(n.description)}}function ve(e,t){if(e&1&&(g(0,"span"),a(1),i(2,"translate"),i(3,"date"),s()),e&2){let n=x().$implicit;o(),q("",r(2,2,"protocols.created"),": ",r(3,4,n.created_at))}}function Me(e,t){if(e&1&&(g(0,"div",5)(1,"h3"),a(2),s(),u(3,xe,2,1,"p",6),g(4,"div",7)(5,"span"),a(6),i(7,"translate"),s(),u(8,ve,4,6,"span"),s()()),e&2){let n=t.$implicit;o(2),d(n.name),o(),C(n.description?3:-1),o(3),q("",r(7,5,"protocols.fieldsCount"),": ",n.fields.length),o(2),C(n.created_at?8:-1)}}function be(e,t){if(e&1&&(g(0,"div",4),b(1,Me,9,7,"div",5,ue),s()),e&2){let n=x();o(),h(n.templates())}}var re=class e{#e=_(G);#n=_(D);#o=_(w);#t=_(B);templates=M([]);loading=M(!1);ngOnInit(){this.loadTemplates()}loadTemplates(){this.loading.set(!0),this.#e.getTemplates().subscribe({next:t=>{this.templates.set(t),this.loading.set(!1)},error:t=>{this.#o.showError(t.message||this.#t.instant("protocols.loadTemplatesFailed")),this.loading.set(!1)}})}createTemplate(){this.#n.open({title:"protocols.createTemplate",component:V}),setTimeout(()=>this.loadTemplates(),500)}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=E({type:e,selectors:[["app-protocols"]],decls:11,vars:7,consts:[[1,"protocols-wrapper"],[1,"header"],["type","button",1,"btn","btn-primary",3,"click"],[1,"empty-state"],[1,"templates-list"],[1,"template-card"],[1,"description"],[1,"template-info"]],template:function(n,m){n&1&&(g(0,"div",0)(1,"div",1)(2,"h1"),a(3),i(4,"translate"),s(),g(5,"button",2),$("click",function(){return m.createTemplate()}),a(6),i(7,"translate"),s()(),u(8,Ce,3,3,"p")(9,Pe,7,6,"div",3)(10,be,3,0,"div",4),s()),n&2&&(o(3),d(r(4,3,"protocols.title")),o(3),f(" ",r(7,5,"protocols.createTemplate")," "),o(2),C(m.loading()?8:m.templates().length===0?9:10))},dependencies:[F,N,R,I],styles:[".protocols-wrapper[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.protocols-wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.protocols-wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.protocols-wrapper[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background:#f9f9f9;border-radius:8px}.protocols-wrapper[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:#666}.protocols-wrapper[_ngcontent-%COMP%]   .templates-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}.protocols-wrapper[_ngcontent-%COMP%]   .templates-list[_ngcontent-%COMP%]   .template-card[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #e0e0e0;border-radius:8px;background:#fff;transition:box-shadow .2s}.protocols-wrapper[_ngcontent-%COMP%]   .templates-list[_ngcontent-%COMP%]   .template-card[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a}.protocols-wrapper[_ngcontent-%COMP%]   .templates-list[_ngcontent-%COMP%]   .template-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem}.protocols-wrapper[_ngcontent-%COMP%]   .templates-list[_ngcontent-%COMP%]   .template-card[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#666;margin-bottom:1rem}.protocols-wrapper[_ngcontent-%COMP%]   .templates-list[_ngcontent-%COMP%]   .template-card[_ngcontent-%COMP%]   .template-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;font-size:.875rem;color:#888}"],changeDetection:0})};export{re as ProtocolsComponent};
