import{$ as E,Aa as B,B as M,C as g,H as $,P as D,Pa as h,Q as I,Qa as H,Ra as x,T as N,U as k,Va as q,Wa as R,Z as m,_ as f,a as F,ba as S,ca as W,ea as T,fa as v,ha as O,i as d,ia as P,l as _,na as L,o as b,oa as U,q as C,r as w,ra as l,ta as z,x as c}from"./chunk-5GMKLZ6Q.js";import{a as u,b as y}from"./chunk-C6Q5SG76.js";var V=class n{#e=b(x);_projects=c([]);_project=c(null);_objects=c([]);_objectsWithProjects=c([]);_loading=c(!1);_error=c(null);_files=c([]);projects=l(()=>this._projects());project=l(()=>this._project());objects=l(()=>this._objects());objectsWithProjects=l(()=>this._objectsWithProjects());loading=l(()=>this._loading());error=l(()=>this._error());files=l(()=>this._files());loadProject(t){if(!t){this._error.set("Project ID is required");return}this._loading.set(!0),this._error.set(null),this.#e.get(`project/${t}`).subscribe({next:e=>{this._project.set(e),this.loadObjects(),this._loading.set(!1)},error:e=>{this._error.set(e.message||"Failed to load project"),this._loading.set(!1)}}),this.#e.get(`file/project/${t}`).subscribe({next:e=>{let o=e.map(i=>y(u({},i),{path:i.path,filename:i.path.split(/[\\/]/).pop()||""}));this._files.set(o)}})}loadProjects(){this._loading.set(!0),this._error.set(null),this.#e.get("projects").subscribe({next:t=>{this._projects.set(t),this._loading.set(!1)},error:t=>{this._error.set(t.message||"Failed to load projects"),this._loading.set(!1)}})}createProject(t){return this._loading.set(!0),this._error.set(null),this.#e.post("projects",t).pipe(d({next:()=>{this.loadProjects(),this._loading.set(!1)},error:e=>{this._error.set(e.message||"Failed to create project"),this._loading.set(!1)}}))}getObjectsByTerm(t){let e=this._project()?._id?.$oid;return e?this.#e.get(`objects/${e}&${t}`).pipe(d(o=>this._objects.set(o))):(this._error.set("No project selected"),new F(o=>{o.error(new Error("No project selected"))}))}createObject(t){return this._loading.set(!0),this._error.set(null),this.#e.post("object",t).pipe(d({next:()=>{this.getObjectsByTerm("").subscribe(),this._loading.set(!1)},error:e=>{this._error.set(e.message||"Failed to create object"),this._loading.set(!1)}}))}loadObjects(){let t=this._project()?._id?.$oid;if(!t){this._error.set("No project selected");return}this._loading.set(!0),this._error.set(null),this.#e.get(`objects/${t}`).subscribe({next:e=>{this._objects.set(e),this._loading.set(!1)},error:e=>{this._error.set(e.message||"Failed to load objects"),this._loading.set(!1)}})}loadAllObjects(){this._loading.set(!0),this._error.set(null),this.#e.get("objects").subscribe({next:t=>{this._objectsWithProjects.set(t),this._loading.set(!1)},error:t=>{this._error.set(t.message||"Failed to load objects"),this._loading.set(!1)}})}loadObject(t){return this.#e.get(`object/${t}`)}updateProjectCategories(t,e){return this.#e.put(`project/${t}/categories`,{categories:e}).pipe(d(o=>{this._project.set(o),this.loadObjects();let i=this._projects(),r=i.findIndex(s=>s._id?.$oid===t);r!==-1&&(i[r]=o,this._projects.set([...i]))}))}updateObjectCategory(t,e){return this.#e.put(`object/${t}/category`,{category:e}).pipe(d(o=>{let i=this._project();if(i?.objects){let a=i.objects.findIndex(j=>j._id?.$oid===t);a!==-1&&(i.objects[a]=o,this._project.set(u({},i)))}let r=this._objects(),s=r.findIndex(a=>a._id?.$oid===t);s!==-1&&(r[s]=o,this._objects.set([...r]))}))}updateObjectStatus(t,e){return this.#e.put(`object/${t}/status`,{status:e}).pipe(d(o=>{let i=this._project();if(i?.objects){let p=i.objects.findIndex(J=>J._id?.$oid===t);p!==-1&&(i.objects[p]=o,this._project.set(u({},i)))}let r=this._objects(),s=r.findIndex(p=>p._id?.$oid===t);s!==-1&&(r[s]=o,this._objects.set([...r]));let a=this._objectsWithProjects(),j=a.findIndex(p=>p.object._id?.$oid===t);j!==-1&&(a[j].object=o,this._objectsWithProjects.set([...a]))}))}clearError(){this._error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})};var Y=class n{#e=b(x);#t=b(H);uploadFile(t,e="object",o){if(!o){let s=e==="project"?"Project ID is required for project file upload":"Object ID is required for object file upload";throw this.#t.showError(s),new Error(s)}let i=`file/${e}/${o}`,r=new B;return this.#e.post(i,t,r)}uploadFileForObject(t,e){return this.uploadFile(t,"object",e)}uploadFileForProject(t,e){return this.uploadFile(t,"project",e)}getFilesForObject(t){let e=`file/object/${t}`;return this.#e.get(e)}getFilesForProject(t){let e=`file/project/${t}`;return this.#e.get(e)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})};var K=(n,t)=>t._id.$oid;function Q(n,t){if(n&1&&(m(0,"p",8),O(1),f()),n&2){let e=v().$implicit;g(),P(e.filename)}}function X(n,t){if(n&1){let e=S();m(0,"li",3),T("click",function(){let i=C(e).$implicit,r=v();return w(r.downloadFile(i.path))}),m(1,"div",4),E(2,"img",5),m(3,"div",6)(4,"span",7),O(5),L(6,"translate"),f()()(),D(7,Q,2,1,"p",8),f()}if(n&2){let e=t.$implicit,o=v();g(2),W("src",o.getImageUrl(e.path),M)("alt",e.filename||"File Preview"),g(3),P(U(6,4,"fileList.download")),g(2),I(e.filename?7:-1)}}var G=class n{files=z([]);getImageUrl(t){let e=t.replace(/^\.?\/*/,"").replace(/\\/g,"/");e.startsWith("uploads/")&&(e=e.substring(8));let i=e.split("/").map(r=>encodeURIComponent(r)).join("/");return`${h.be}${h.folderBase}/${i}`}downloadFile(t){let e=t.replace(/^\.?\/*/,"").replace(/\\/g,"/");e.startsWith("uploads/")&&(e=e.substring(8));let i=e.split("/").map(a=>encodeURIComponent(a)).join("/"),r=`${h.be}${h.folderBase}/${i}`;console.log(r);let s=document.createElement("a");s.href=r,s.target="_blank",s.rel="noopener",s.download=e.split("/").pop()||"file",document.body.appendChild(s),s.click(),document.body.removeChild(s)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=$({type:n,selectors:[["app-file-list"]],inputs:{files:[1,"files"]},decls:4,vars:0,consts:[[1,"file-wrapper"],[1,"file-gallery"],[1,"file-item"],[1,"file-item",3,"click"],[1,"image-container"],["loading","lazy",3,"src","alt"],[1,"overlay"],[1,"download-hint"],[1,"file-name"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"ul",1),N(2,X,8,6,"li",2,K),f()()),e&2&&(g(2),k(o.files()))},dependencies:[R,q],styles:[".file-wrapper[_ngcontent-%COMP%]{width:100%;padding:var(--space, 1rem);max-height:70vh;overflow:auto}@media screen and (max-width: 768px){.file-wrapper[_ngcontent-%COMP%]{max-height:50vh;width:100%;display:block}}.file-gallery[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--space, 1rem);list-style-type:none;margin:0;padding:0}.file-item[_ngcontent-%COMP%]{cursor:pointer;display:flex;flex-direction:column;border-radius:8px;overflow:hidden;border:1px solid var(--default-color, #e0e0e0);background:var(--background-color, #fff);transition:transform .2s ease,box-shadow .2s ease}.file-item[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 12px #00000026}.file-item[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.image-container[_ngcontent-%COMP%]{position:relative;width:100%;padding-top:100%;overflow:hidden;background:var(--background-color-secondary, #f5f5f5)}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.file-item[_ngcontent-%COMP%]:hover   .image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:scale(1.05)}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease}.download-hint[_ngcontent-%COMP%]{color:#fff;font-weight:500;font-size:.9rem;text-align:center;padding:.5rem 1rem;background:#fff3;border-radius:4px;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.file-name[_ngcontent-%COMP%]{margin:0;padding:.75rem;font-size:.875rem;text-align:center;color:var(--text-color, #333);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border-top:1px solid var(--default-color, #e0e0e0)}"],changeDetection:0})};export{V as a,Y as b,G as c};
