import{a as O,b as Fe,c as Ee}from"./chunk-3OVHKP5J.js";import{a as de,b as ee,c as K}from"./chunk-6LKDQ6BM.js";import{a as w,b as me}from"./chunk-K5OQVDQI.js";import{b as L,c as E,d as I,e as N,f as we,g as re,h as k,j as D,k as pe,l as Te,m as B,n as z,o as q,p as U,q as W,r as G}from"./chunk-JDIK4ESQ.js";import{a as te}from"./chunk-DWUAIN37.js";import{C as r,D as Pe,H as S,Ja as Oe,Ma as se,O as J,P as _,Q as C,Qa as Z,R as Se,S as Q,T as y,U as M,V as g,Va as V,W as a,Wa as A,X as n,Y as b,ba as F,da as h,fa as f,g as ye,h as Me,ha as l,ia as d,ja as v,ka as ae,na as s,o as m,oa as p,q as j,r as P,ra as le,s as ie,sa as ce,t as je,ta as R,x as T,ya as X}from"./chunk-5GMKLZ6Q.js";import{a as H,b as Y}from"./chunk-C6Q5SG76.js";function ke(o,t){if(o&1&&(a(0,"option",16),l(1),n()),o&2){let e=t.$implicit,i=f(2);g("value",e),r(),d(i.statusLabel(e))}}function De(o,t){if(o&1){let e=F();a(0,"form",1)(1,"div",2)(2,"label",3),l(3,"Name"),n(),b(4,"input",4),n(),a(5,"div",5)(6,"h4"),l(7,"Address"),n(),a(8,"div",2)(9,"label",6),l(10,"Country"),n(),b(11,"input",7),n(),a(12,"div",2)(13,"label",8),l(14,"City"),n(),b(15,"input",9),n(),a(16,"div",2)(17,"label",10),l(18,"Street"),n(),b(19,"input",11),n()(),a(20,"div",2)(21,"label",12),l(22,"Note"),n(),b(23,"input",13),n(),a(24,"div",2)(25,"label",14),l(26,"Status"),n(),a(27,"select",15),y(28,ke,2,2,"option",16,Q),n()(),a(30,"div",17)(31,"button",18),h("click",function(){j(e);let c=f();return P(c.Submit())}),l(32,"Submit"),n()()()}if(o&2){let e=f();g("formGroup",e.form),r(28),M(e.statuses),r(3),g("disabled",e.form.invalid)}}var ue=class o{#e=m(W);#n=m(O);#i=m(w);statuses=de;statusLabel=K;form=this.#e.group({name:["",[E.required]],address:this.#e.group({city:[""],street:[""],country:[""]}),note:[""],status:[ee,[E.required]]});Submit(){let t=this.form.getRawValue();this.#n.createProject(t).subscribe({next:()=>{this.#i.close()}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-modal-project"]],decls:2,vars:1,consts:[[1,"wrapper"],[3,"formGroup"],[1,"control"],["for","name"],["placeholder","Name","type","name","id","name","formControlName","name"],["formGroupName","address",1,"control"],["for","country"],["placeholder","country","type","country","id","country","formControlName","country"],["for","city"],["placeholder","city","type","city","id","city","formControlName","city"],["for","street"],["placeholder","street","type","street","id","street","formControlName","street"],["for","note"],["placeholder","Note","type","note","id","note","formControlName","note"],["for","status"],["id","status","formControlName","status"],[3,"value"],[1,"control","buttons"],["type","button",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",0),_(1,De,33,2,"form",1),n()),e&2&&(r(),C(i.form?1:-1))},dependencies:[G,k,q,U,L,z,I,N,D,B,pe],encapsulation:2,changeDetection:0})};var Be=(o,t)=>t._id;function Ge(o,t){if(o&1&&(a(0,"li"),l(1),s(2,"translate"),n()),o&2){let e=f().$implicit;r(),ae(" ",p(2,2,"objects.level"),": ",e.address==null?null:e.address.level," ")}}function Ve(o,t){if(o&1&&(a(0,"li"),l(1),s(2,"translate"),n()),o&2){let e=f().$implicit;r(),ae(" ",p(2,2,"objects.doorNumber"),": ",e.address==null?null:e.address.door_number," ")}}function Ae(o,t){if(o&1&&(a(0,"div",6)(1,"span",7),l(2),n(),a(3,"h2",8),l(4),n(),a(5,"div",9)(6,"ul",10)(7,"li"),l(8),n(),_(9,Ge,3,4,"li"),_(10,Ve,3,4,"li"),n()()()),o&2){let e=t.$implicit,i=f(2);g("routerLink","tab/"+(e._id==null?null:e._id.$oid)),r(),J("data-status",e.status||i.defaultStatus),r(),v(" ",i.formatStatus(e.status)," "),r(2),d(e.name),r(4),ae(" ",e.address==null?null:e.address.street," ",e.address==null?null:e.address.house_number," "),r(),C(e.address!=null&&e.address.level?9:-1),r(),C(e.address!=null&&e.address.door_number?10:-1)}}function Re(o,t){if(o&1&&(a(0,"div",1),y(1,Ae,11,8,"div",6,Be),n()),o&2){let e=f();r(),M(e.projects())}}function $e(o,t){o&1&&(l(0),s(1,"translate")),o&2&&v(" ",p(1,1,"projects.noProjects")," ")}var fe=class o{#e=m(O);#n=m(w);projects=this.#e.projects;defaultStatus=ee;formatStatus=K;newProject(){this.#n.open({title:"projects.newProject",component:ue})}ngOnInit(){this.#e.loadProjects()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-projects"]],decls:11,vars:8,consts:[[1,"projects-wrapper"],[1,"card-wrapper"],["type","button",1,"add-icon","floating-icon",3,"click","tabIndex"],["role","button",1,"add"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24"],["stroke","white","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 5v14m-7-7h14"],[1,"card",3,"routerLink"],[1,"status-pill"],[1,"headline"],[1,"content"],[1,"data-list"]],template:function(e,i){e&1&&(a(0,"h1"),l(1),s(2,"translate"),n(),a(3,"div",0),_(4,Re,3,0,"div",1)(5,$e,2,3),a(6,"button",2),s(7,"translate"),h("click",function(){return i.newProject()}),a(8,"i",3),ie(),a(9,"svg",4),b(10,"path",5),n()()()()),e&2&&(r(),d(p(2,4,"projects.title")),r(3),C(i.projects().length?4:5),r(2),g("tabIndex",2),J("aria-label",p(7,6,"objects.add")))},dependencies:[se,A,V],styles:["[_nghost-%COMP%]{display:block}h1[_ngcontent-%COMP%]{text-align:center;margin:var(--space) 0}.projects-wrapper[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;gap:.5rem}.status-pill[_ngcontent-%COMP%]{align-self:flex-start;padding:.15rem .75rem;border-radius:999px;font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;background-color:#e0e0e0;color:#1a1a1a}.status-pill[data-status=in_progress][_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404}.status-pill[data-status=verified][_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-pill[data-status=closed][_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.status-pill[data-status=created][_ngcontent-%COMP%]{background-color:#e2e3e5;color:#383d41}.card[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;gap:.25rem}"],changeDetection:0})};function Le(o,t){if(o&1&&(a(0,"option",11),l(1),n()),o&2){let e=t.$implicit;g("value",e),r(),d(e)}}function ze(o,t){if(o&1&&(a(0,"div",3)(1,"label",8),l(2),s(3,"translate"),n(),a(4,"select",9)(5,"option",10),l(6),s(7,"translate"),n(),y(8,Le,2,2,"option",11,Q),n()()),o&2){let e=f();r(2),d(p(3,2,"filter.category")),r(4),d(p(7,4,"filter.allCategories")),r(2),M(e.filter().categories)}}function qe(o,t){o&1&&(a(0,"div",12)(1,"label",13),l(2),s(3,"translate"),n(),b(4,"input",14),n(),a(5,"div",12)(6,"label",15),l(7),s(8,"translate"),n(),b(9,"input",16),n()),o&2&&(r(2),d(p(3,2,"filter.dateFrom")),r(5),d(p(8,4,"filter.dateTo")))}var Ce=class o{filter=R.required();filterChange=new Pe;currentFilter={};searchForm=new we({search:new re(""),category:new re(""),dateFrom:new re(""),dateTo:new re("")});constructor(){this.searchForm.get("search")?.valueChanges.pipe(ye(300),Me()).subscribe(t=>{this.currentFilter=Y(H({},this.currentFilter),{searchText:t?.toString()}),this.emitFilterChange()}),this.searchForm.get("category")?.valueChanges.subscribe(t=>{this.currentFilter=Y(H({},this.currentFilter),{category:t?.toString()}),this.emitFilterChange()}),this.searchForm.get("dateFrom")?.valueChanges.subscribe(t=>{this.currentFilter=Y(H({},this.currentFilter),{dateFrom:t?.toString()}),this.emitFilterChange()}),this.searchForm.get("dateTo")?.valueChanges.subscribe(t=>{this.currentFilter=Y(H({},this.currentFilter),{dateTo:t?.toString()}),this.emitFilterChange()})}ngOnInit(){let t=this.filter();t.value&&this.searchForm.patchValue({search:t.value}),t.selectedCategory&&this.searchForm.patchValue({category:t.selectedCategory}),t.dateFrom&&this.searchForm.patchValue({dateFrom:t.dateFrom}),t.dateTo&&this.searchForm.patchValue({dateTo:t.dateTo})}emitFilterChange(){this.filterChange.emit(this.currentFilter)}clearFilters(){this.searchForm.reset({search:"",category:"",dateFrom:"",dateTo:""})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-filter"]],inputs:{filter:[1,"filter"]},outputs:{filterChange:"filterChange"},decls:15,vars:12,consts:[[1,"wrapper","filter-wrapper"],[3,"formGroup"],[1,"filter-controls"],[1,"control"],["for","search"],["id","search","title","search","type","text","formControlName","search",1,"filter-input",3,"placeholder"],[1,"control","control-actions"],["type","button",1,"btn","btn-secondary","btn-small",3,"click"],["for","category"],["id","category","formControlName","category",1,"filter-input"],["value",""],[3,"value"],[1,"control","date-range"],["for","dateFrom"],["id","dateFrom","type","date","formControlName","dateFrom",1,"filter-input"],["for","dateTo"],["id","dateTo","type","date","formControlName","dateTo",1,"filter-input"]],template:function(e,i){if(e&1&&(a(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),l(5),s(6,"translate"),n(),b(7,"input",5),s(8,"translate"),n(),_(9,ze,10,6,"div",3),_(10,qe,10,6),a(11,"div",6)(12,"button",7),h("click",function(){return i.clearFilters()}),l(13),s(14,"translate"),n()()()()()),e&2){let c;r(),g("formGroup",i.searchForm),r(4),d(p(6,6,i.filter().label)),r(2),g("placeholder",p(8,8,i.filter().placeholder)),r(2),C(i.filter().showCategory&&(((c=i.filter().categories)==null?null:c.length)??0)>0?9:-1),r(),C(i.filter().showDateRange?10:-1),r(3),v(" ",p(14,10,"filter.clear")," ")}},dependencies:[X,G,k,q,U,L,z,I,N,D,B,A,V],styles:[".wrapper.filter-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-bottom:1rem}form[_ngcontent-%COMP%]{width:100%;max-width:100%}.filter-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:1rem}.control[_ngcontent-%COMP%]{display:flex;flex-direction:column}.control.date-range[_ngcontent-%COMP%]{min-width:150px;flex:0 1 auto}.control-actions[_ngcontent-%COMP%]{min-width:auto;justify-content:flex-end}.filter-input[_ngcontent-%COMP%]{border:1px solid var(--default-color);border-radius:6px;padding:8px 12px;font-size:1rem;transition:border-color .2s,box-shadow .2s}.filter-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#094c43;box-shadow:0 0 4px #0b63574d}select.filter-input[_ngcontent-%COMP%]{cursor:pointer}.btn-small[_ngcontent-%COMP%]{padding:8px 16px;font-size:.9rem}@media (max-width: 768px){.wrapper.filter-wrapper[_ngcontent-%COMP%]{padding:12px}label[_ngcontent-%COMP%]{font-size:.9rem}.filter-input[_ngcontent-%COMP%]{padding:8px 10px;font-size:.9rem;min-height:44px}}@media (max-width: 480px){.wrapper.filter-wrapper[_ngcontent-%COMP%]{padding:8px}form[_ngcontent-%COMP%]{max-width:100%}label[_ngcontent-%COMP%]{font-size:.85rem}.filter-input[_ngcontent-%COMP%]{font-size:.85rem;padding:8px}}"]})};function Ue(o,t){if(o&1&&(a(0,"option",16),l(1),n()),o&2){let e=t.$implicit,i=f(2);g("value",e),r(),d(i.statusLabel(e))}}function We(o,t){if(o&1){let e=F();a(0,"form",1)(1,"div",2)(2,"h4"),l(3,"Address"),n(),a(4,"div",3)(5,"label",4),l(6,"Street"),n(),b(7,"input",5),n(),a(8,"div",3)(9,"label",6),l(10,"House number"),n(),b(11,"input",7),n(),a(12,"div",3)(13,"label",8),l(14,"Level / floor"),n(),b(15,"input",9),n(),a(16,"div",3)(17,"label",10),l(18,"Door number"),n(),b(19,"input",11),n()(),a(20,"div",3)(21,"label",12),l(22,"Note"),n(),b(23,"input",13),n(),a(24,"div",3)(25,"label",14),l(26,"Status"),n(),a(27,"select",15),y(28,Ue,2,2,"option",16,Q),n()(),a(30,"div",17)(31,"button",18),h("click",function(){j(e);let c=f();return P(c.Submit())}),l(32,"Submit"),n()()()}if(o&2){let e=f();g("formGroup",e.form),r(28),M(e.statuses),r(3),g("disabled",e.form.invalid)}}var be=class o{#e=m(W);#n=m(O);#i=m(w);statuses=de;statusLabel=K;form=this.#e.group({address:this.#e.group({street:[""],house_number:[""],level:[""],door_number:[""]}),note:[""],status:[ee,[E.required]]});Submit(){let t=Y(H({},this.form.getRawValue()),{projectId:this.#n.project()?._id});this.#n.createObject(t).subscribe({next:e=>{this.#i.close(),this.#n.loadObjects()}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-new-object"]],decls:2,vars:1,consts:[[1,"wrapper"],[3,"formGroup"],["formGroupName","address",1,"control"],[1,"control"],["for","street"],["placeholder","street","type","text","id","street","formControlName","street"],["for","house_number"],["placeholder","house number","type","text","id","house_number","formControlName","house_number"],["for","level"],["placeholder","e.g. 3 or 3rd","type","text","id","level","formControlName","level"],["for","door_number"],["placeholder","door or flat number","type","text","id","door_number","formControlName","door_number"],["for","note"],["placeholder","Note","type","note","id","note","formControlName","note"],["for","status"],["id","status","formControlName","status"],[3,"value"],[1,"control","buttons"],["type","button",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",0),_(1,We,33,2,"form",1),n()),e&2&&(r(),C(i.form?1:-1))},dependencies:[G,k,q,U,L,z,I,N,D,B,pe],encapsulation:2,changeDetection:0})};var Ie=(o,t)=>t._id==null?null:t._id.$oid;function Ke(o,t){if(o&1&&(a(0,"option",6),l(1),n()),o&2){let e=t.$implicit;g("value",e._id==null?null:e._id.$oid),r(),d(e.name)}}function He(o,t){o&1&&(a(0,"span",7),l(1),s(2,"translate"),n()),o&2&&(r(),d(p(2,1,"protocols.templateRequired")))}function Ye(o,t){o&1&&(a(0,"p",8),l(1),s(2,"translate"),n()),o&2&&(r(),d(p(2,1,"protocols.noObjectsAvailable")))}function Je(o,t){if(o&1){let e=F();a(0,"label",16)(1,"input",17),h("change",function(c){let u=j(e).$implicit,x=f(2);return P(x.toggleSelection(u._id==null?null:u._id.$oid,c.target.checked))}),n(),a(2,"span"),l(3),n()()}if(o&2){let e=t.$implicit,i=f(2);r(),g("checked",i.isSelected(e._id==null?null:e._id.$oid)),r(2),d(i.formatObjectLabel(e))}}function Qe(o,t){o&1&&(a(0,"span",7),l(1),s(2,"translate"),n()),o&2&&(r(),d(p(2,1,"protocols.selectObjectsRequired")))}function Xe(o,t){if(o&1&&(a(0,"div",9)(1,"p",13),l(2),s(3,"translate"),n(),a(4,"p",14),l(5),s(6,"translate"),n(),a(7,"div",15),y(8,Je,4,2,"label",16,Ie),n(),_(10,Qe,3,3,"span",7),n()),o&2){let e=f();r(2),d(p(3,3,"protocols.selectObjects")),r(3),v(" ",p(6,5,"protocols.selectObjectsDescription")," "),r(3),M(e.objects()),r(2),C(e.hasSelection()?-1:10)}}function Ze(o,t){o&1&&(l(0),s(1,"translate")),o&2&&v(" ",p(1,1,"protocols.generating")," ")}function et(o,t){o&1&&(l(0),s(1,"translate")),o&2&&v(" ",p(1,1,"protocols.generate")," ")}var he=class o{#e=m(W);#n=m(me);#i=m(w);#t=m(Z);#o=m(te);#l=m(O);projectId=R.required();objects=R.required();templates=R.required();form;generating=T(!1);selectedObjectIds=T([]);hasSelection=le(()=>this.selectedObjectIds().length>0);#r=T(!1);#a=ce(()=>{let t=this.objects();if(!t?.length){this.selectedObjectIds.set([]),this.#r.set(!1);return}let e=t.map(c=>c._id?.$oid).filter(c=>!!c),i=this.selectedObjectIds().filter(c=>e.includes(c));this.#r()?i.length!==this.selectedObjectIds().length&&this.selectedObjectIds.set(i):(this.selectedObjectIds.set(i.length?i:e),this.#r.set(!0))});constructor(){this.form=this.#e.group({template_id:["",[E.required]]})}onSubmit(){if(this.form.invalid){this.#t.showError(this.#o.instant("protocols.selectTemplate"));return}if(!this.hasSelection()){this.#t.showError(this.#o.instant("protocols.selectObjectsRequired"));return}this.generating.set(!0);let t=this.form.value.template_id,e=this.projectId(),i=this.selectedObjectIds();if(!e||i.length===0){this.generating.set(!1),this.#t.showError(this.#o.instant("protocols.generateMissingData"));return}let c={template_id:t,project_id:e,object_ids:i};this.#n.downloadProtocol(c).subscribe({next:()=>{this.#l.loadProject(e),this.generating.set(!1),this.#t.showSuccess(this.#o.instant("protocols.generated")),this.#i.close()},error:u=>{this.generating.set(!1),this.#t.showError(u.message||this.#o.instant("protocols.generateFailed"))}})}close(){this.#i.close()}toggleSelection(t,e){if(!t)return;let i=new Set(this.selectedObjectIds());e?i.add(t):i.delete(t),this.selectedObjectIds.set(Array.from(i))}isSelected(t){return t?this.selectedObjectIds().includes(t):!1}formatObjectLabel(t){let e=t.address?.street??"",i=t.address?.house_number?` ${t.address?.house_number}`:"",c=t.address?.level?`, L${t.address?.level}`:"",u=t.address?.door_number?`, D${t.address?.door_number}`:"";return`${e}${i}${c}${u}`.trim()||t._id?.$oid||""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-protocol-generate-modal"]],inputs:{projectId:[1,"projectId"],objects:[1,"objects"],templates:[1,"templates"]},decls:25,vars:17,consts:[[1,"protocol-generate-form"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","template_id"],["id","template_id","formControlName","template_id"],["value",""],[3,"value"],[1,"error"],[1,"empty-state"],[1,"object-selection"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"section-title"],[1,"helper-text"],[1,"object-list"],[1,"object-item"],["type","checkbox",3,"change","checked"]],template:function(e,i){if(e&1&&(a(0,"div",0)(1,"h2"),l(2),s(3,"translate"),n(),a(4,"form",1),h("ngSubmit",function(){return i.onSubmit()}),a(5,"div",2)(6,"label",3),l(7),s(8,"translate"),n(),a(9,"select",4)(10,"option",5),l(11),s(12,"translate"),n(),y(13,Ke,2,2,"option",6,Ie),n(),_(15,He,3,3,"span",7),n(),_(16,Ye,3,3,"p",8)(17,Xe,11,7,"div",9),a(18,"div",10)(19,"button",11),h("click",function(){return i.close()}),l(20),s(21,"translate"),n(),a(22,"button",12),_(23,Ze,2,3)(24,et,2,3),n()()()()),e&2){let c;r(2),d(p(3,9,"protocols.generateProtocol")),r(2),g("formGroup",i.form),r(3),v("",p(8,11,"protocols.selectTemplate")," *"),r(4),d(p(12,13,"protocols.selectTemplate")),r(2),M(i.templates()),r(2),C((c=i.form.get("template_id"))!=null&&c.invalid&&((c=i.form.get("template_id"))!=null&&c.touched)?15:-1),r(),C(i.objects().length===0?16:17),r(4),v(" ",p(21,15,"common.cancel")," "),r(2),g("disabled",i.generating()||i.form.invalid||!i.hasSelection()),r(),C(i.generating()?23:24)}},dependencies:[X,G,k,q,U,z,I,N,D,B,A,V],styles:[".protocol-generate-form[_ngcontent-%COMP%]{padding:2rem;min-width:400px}.protocol-generate-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .protocol-generate-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.protocol-generate-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.protocol-generate-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}.protocol-generate-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:#d32f2f;font-size:.875rem;display:block;margin-top:.25rem}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]{margin-bottom:1.5rem}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:.25rem}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]   .helper-text[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.9rem;color:#666}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]   .object-list[_ngcontent-%COMP%]{max-height:220px;overflow-y:auto;border:1px solid #ddd;border-radius:6px;padding:.5rem;display:flex;flex-direction:column;gap:.5rem}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]   .object-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.95rem;color:#333}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]   .object-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:16px;height:16px}.protocol-generate-form[_ngcontent-%COMP%]   .object-selection[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{display:block;margin-top:.5rem}.protocol-generate-form[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{padding:1rem;border-radius:6px;background-color:#f5f5f5;color:#555}.protocol-generate-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem;padding-top:1rem;border-top:1px solid #ddd}"]})};function tt(o,t){if(o&1){let e=F();a(0,"div",9),b(1,"input",13),a(2,"button",14),h("click",function(){let c=j(e).$index,u=f();return P(u.removeCategory(c))}),l(3),s(4,"translate"),n()()}if(o&2){let e=t.$index;r(),g("formControlName",e),r(2),v(" ",p(4,2,"common.delete")," ")}}function ot(o,t){o&1&&(a(0,"p",10),l(1),s(2,"translate"),n()),o&2&&(r(),d(p(2,1,"projects.noCategories")))}function nt(o,t){o&1&&(l(0),s(1,"translate")),o&2&&v(" ",p(1,1,"common.saving")," ")}function it(o,t){o&1&&(l(0),s(1,"translate")),o&2&&v(" ",p(1,1,"common.save")," ")}var ve=class o{#e=m(W);#n=m(w);#i=m(Z);#t=m(te);#o=m(O);projectId=R.required();categories=R([]);form;saving=T(!1);constructor(){this.form=this.#e.group({categories:this.#e.array([]),newCategory:[""]})}get categoryArray(){return this.form.get("categories")}ngOnInit(){let t=this.categories();t&&t.length>0&&t.forEach(e=>{this.categoryArray.push(this.#e.control(e,[E.required]))})}addCategory(){let t=this.form.get("newCategory")?.value?.trim();if(t){if(this.categoryArray.value.includes(t)){this.#i.showError(this.#t.instant("projects.categoryExists"));return}this.categoryArray.push(this.#e.control(t,[E.required])),this.form.patchValue({newCategory:""})}}removeCategory(t){this.categoryArray.removeAt(t)}save(){this.saving.set(!0);let t=this.categoryArray.value.filter(e=>e?.trim());this.#o.updateProjectCategories(this.projectId(),t).subscribe({next:()=>{this.#i.showSuccess(this.#t.instant("projects.categoriesUpdated")),this.saving.set(!1),this.#n.close()},error:e=>{this.#i.showError(e.message||this.#t.instant("projects.updateCategoriesFailed")),this.saving.set(!1)}})}close(){this.#n.close()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-category-management-modal"]],inputs:{projectId:[1,"projectId"],categories:[1,"categories"]},decls:30,vars:22,consts:[[1,"category-management-form"],[3,"formGroup"],[1,"form-group"],["for","newCategory"],[1,"input-group"],["type","text","id","newCategory","formControlName","newCategory",3,"placeholder"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"categories-list"],["formArrayName","categories",1,"category-items"],[1,"category-item"],[1,"empty-message"],[1,"form-actions"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","text",3,"formControlName"],["type","button",1,"btn","btn-danger","btn-small",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"h2"),l(2),s(3,"translate"),n(),a(4,"form",1)(5,"div",2)(6,"label",3),l(7),s(8,"translate"),n(),a(9,"div",4),b(10,"input",5),s(11,"translate"),a(12,"button",6),h("click",function(){return i.addCategory()}),l(13),s(14,"translate"),n()()(),a(15,"div",7)(16,"h3"),l(17),s(18,"translate"),n(),a(19,"div",8),y(20,tt,5,4,"div",9,Se),_(22,ot,3,3,"p",10),n()(),a(23,"div",11)(24,"button",6),h("click",function(){return i.close()}),l(25),s(26,"translate"),n(),a(27,"button",12),h("click",function(){return i.save()}),_(28,nt,2,3)(29,it,2,3),n()()()()),e&2&&(r(2),d(p(3,10,"projects.manageCategories")),r(2),g("formGroup",i.form),r(3),d(p(8,12,"projects.addCategory")),r(3),g("placeholder",p(11,14,"projects.categoryName")),r(3),v(" ",p(14,16,"common.add")," "),r(4),d(p(18,18,"projects.categories")),r(3),M(i.categoryArray.controls),r(2),C(i.categoryArray.length===0?22:-1),r(3),v(" ",p(26,20,"common.cancel")," "),r(2),g("disabled",i.saving()),r(),C(i.saving()?28:29))},dependencies:[X,G,k,L,I,N,D,B,Te,A,V],styles:[".category-management-form[_ngcontent-%COMP%]{padding:2rem;min-width:500px;max-width:700px}.category-management-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .category-management-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.category-management-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.category-management-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.category-management-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}.category-management-form[_ngcontent-%COMP%]   .categories-list[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid #ddd}.category-management-form[_ngcontent-%COMP%]   .categories-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem}.category-management-form[_ngcontent-%COMP%]   .categories-list[_ngcontent-%COMP%]   .category-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.category-management-form[_ngcontent-%COMP%]   .categories-list[_ngcontent-%COMP%]   .category-items[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.category-management-form[_ngcontent-%COMP%]   .categories-list[_ngcontent-%COMP%]   .category-items[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}.category-management-form[_ngcontent-%COMP%]   .categories-list[_ngcontent-%COMP%]   .category-items[_ngcontent-%COMP%]   .empty-message[_ngcontent-%COMP%]{color:#666;font-style:italic;padding:1rem;text-align:center}.category-management-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem;padding-top:1rem;border-top:1px solid #ddd}"]})};var rt=(o,t)=>t._id==null?null:t._id.$oid,at=(o,t)=>t._id.$oid;function lt(o,t){if(o&1&&(a(0,"p",20),l(1),n()),o&2){let e=f().$implicit;r(),d(e.note)}}function ct(o,t){if(o&1&&(a(0,"div",21),l(1),n()),o&2){let e=f().$implicit;r(),d(e.category)}}function st(o,t){if(o&1&&(a(0,"div",17)(1,"span",18),l(2),n(),a(3,"h2",19),l(4),n(),_(5,lt,2,1,"p",20),_(6,ct,2,1,"div",21),n()),o&2){let e=t.$implicit,i=f(2);g("routerLink","/objects/tab/"+(e._id==null?null:e._id.$oid)),r(),J("data-status",e.status),r(),v(" ",i.formatStatus(e.status)," "),r(2),d(e.address.street),r(),C(e.note?5:-1),r(),C(e.category?6:-1)}}function pt(o,t){if(o&1&&(a(0,"div",10),y(1,st,7,6,"div",17,rt),n()),o&2){let e=f();r(),M(e.filteredObjects())}}function dt(o,t){if(o&1){let e=F();a(0,"div",25)(1,"div",26)(2,"p",27),l(3),n(),a(4,"p",28)(5,"span"),l(6),n(),a(7,"span",29),l(8,"\u2022"),n(),a(9,"span"),l(10),n()()(),a(11,"button",30),h("click",function(){let c=j(e).$implicit,u=f(3);return P(u.downloadProtocol(c))}),l(12),s(13,"translate"),n()()}if(o&2){let e=t.$implicit,i=f(3);r(3),d(e.template_name),r(3),d(i.protocolDescription(e)),r(4),d(i.protocolGeneratedAt(e)),r(2),v(" ",p(13,4,"protocols.download")," ")}}function mt(o,t){if(o&1&&(a(0,"div",23),y(1,dt,14,6,"div",25,at),n()),o&2){let e=f(2);r(),M(e.projectProtocols())}}function ut(o,t){o&1&&(a(0,"p",24),l(1),s(2,"translate"),n()),o&2&&(r(),d(p(2,1,"protocols.noProtocolsYet")))}function gt(o,t){if(o&1&&(a(0,"section",11)(1,"div",22)(2,"h3"),l(3),s(4,"translate"),n()(),_(5,mt,3,0,"div",23)(6,ut,3,3,"p",24),n()),o&2){let e=f();r(3),d(p(4,2,"protocols.generatedProtocols")),r(2),C(e.projectProtocols().length>0?5:6)}}function ft(o,t){if(o&1&&b(0,"app-file-list",12),o&2){let e=f();g("files",e.files())}}var xe=class o{#e=m(Oe);#n=m(O);#i=m(w);#t=m(Z);#o=m(te);#l=m(Fe);#r=m(me);project=this.#n.project;objects=this.#n.objects;files=this.#n.files;imagePreviewUrl=T(null);uploading=T(!1);filteredObjects=T([]);#a=T({});formatStatus=K;projectProtocols=le(()=>[...this.project()?.protocols??[]].sort((e,i)=>{let c=e.generated_at?new Date(e.generated_at).getTime():0;return(i.generated_at?new Date(i.generated_at).getTime():0)-c}));constructor(){ce(()=>{let t=this.objects()||[],e=this.#a();this.filteredObjects.set(this.#c(t,e))})}ngOnInit(){let t=this.#e.snapshot.paramMap.get("id");t&&this.#n.loadProject(t),this.#a.set({})}filterData(){return{placeholder:"common.search",value:"",label:"common.search",showDateRange:!0,showCategory:!0,categories:this.project()?.categories||[]}}filterChanged(t){this.#a.set(t)}addObject(){this.#i.open({title:"objects.newObject",component:be})}manageCategories(){let t=this.project(),e=this.#e.snapshot.paramMap.get("id");!t||!e||this.#i.open({title:"projects.manageCategories",component:ve,componentInputs:{projectId:e,categories:t.categories||[]}})}generateProtocol(){let t=this.filteredObjects();if(!t.length){this.#t.showError(this.#o.instant("protocols.noObjectsAvailable"));return}this.#r.getTemplates().subscribe({next:e=>{if(e.length===0){this.#t.showError(this.#o.instant("protocols.noTemplates"));return}let i=this.#e.snapshot.paramMap.get("id");if(!i){this.#t.showError(this.#o.instant("protocols.generateMissingData"));return}this.#i.open({title:"protocols.generateProtocol",component:he,componentInputs:{projectId:i,objects:t,templates:e}})},error:e=>{this.#t.showError(e.message||this.#o.instant("protocols.loadTemplatesFailed"))}})}downloadProtocol(t){let e=this.#e.snapshot.paramMap.get("id"),i=t.template_id?.$oid,c=t.object_ids?.map(u=>u.$oid).filter(u=>!!u)||[];if(!e||!i||c.length===0){this.#t.showError(this.#o.instant("protocols.downloadFailed"));return}this.#r.downloadProtocol({template_id:i,project_id:e,object_ids:c}).subscribe({next:()=>{this.#t.showSuccess(this.#o.instant("protocols.generated"))},error:u=>{this.#t.showError(u.message||this.#o.instant("protocols.downloadFailed"))}})}protocolDescription(t){return t.object_names?.length?t.object_names.join(", "):this.#o.instant("protocols.noObjectsAvailable")}protocolGeneratedAt(t){return t.generated_at?new Date(t.generated_at).toLocaleString():""}onFileSelected(t){let e=t.target;if(!e.files?.length)return;let i=e.files[0];if(!i.type.startsWith("image/")){this.#t.showError(this.#o.instant("errors.imageFileRequired")),this.imagePreviewUrl.set(null),e.value="";return}let c=new FileReader;c.onload=x=>{this.imagePreviewUrl.set(x.target?.result)},c.readAsDataURL(i);let u=this.#e.snapshot.paramMap.get("id");if(!u){this.#t.showError(this.#o.instant("errors.objectIdNotFound"));return}this.uploadFile(i,u)}uploadFile(t,e){this.uploading.set(!0);let i=new FormData;i.append("avatar",t,t.name),this.#l.uploadFileForProject(i,e).subscribe({next:()=>{this.#t.showSuccess(this.#o.instant("objects.uploadSuccess")),this.#n.loadProject(e),this.uploading.set(!1)},error:c=>{this.#t.showError(c.message||this.#o.instant("errors.uploadFailed")),this.uploading.set(!1),this.imagePreviewUrl.set(null)}})}#c(t,e){let i=[...t];if(e.searchText){let c=e.searchText.toLowerCase();i=i.filter(u=>{let x=u.address,$=[x?.street,x?.house_number,x?.level,x?.door_number].filter(Boolean).join(" ").toLowerCase(),Ne=u.note?.toLowerCase()??"";return $.includes(c)||Ne.includes(c)})}return e.category&&(i=i.filter(c=>c.category===e.category)),(e.dateFrom||e.dateTo)&&(i=i.filter(c=>{let u=c.createdAt??c.created_at;if(!u)return!1;let x=new Date(u);if(Number.isNaN(x.getTime()))return!1;if(e.dateFrom){let $=new Date(e.dateFrom);if(!Number.isNaN($.getTime())&&x<$)return!1}if(e.dateTo){let $=new Date(e.dateTo);if(!Number.isNaN($.getTime())&&($.setHours(23,59,59,999),x>$))return!1}return!0})),i}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-project-tab"]],decls:25,vars:16,consts:[["fileInput",""],[1,"wrapper"],[3,"filterChange","filter"],["for","file",1,"icon","upload-icon","floating-icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 640 640"],["d","M352 173.3L352 384C352 401.7 337.7 416 320 416C302.3 416 288 401.7 288 384L288 173.3L246.6 214.7C234.1 227.2 213.8 227.2 201.3 214.7C188.8 202.2 188.8 181.9 201.3 169.4L297.3 73.4C309.8 60.9 330.1 60.9 342.6 73.4L438.6 169.4C451.1 181.9 451.1 202.2 438.6 214.7C426.1 227.2 405.8 227.2 393.3 214.7L352 173.3zM320 464C364.2 464 400 428.2 400 384L480 384C515.3 384 544 412.7 544 448L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 448C96 412.7 124.7 384 160 384L240 384C240 428.2 275.8 464 320 464zM464 488C477.3 488 488 477.3 488 464C488 450.7 477.3 440 464 440C450.7 440 440 450.7 440 464C440 477.3 450.7 488 464 488z"],["type","file","name","file","id","file","accept","image/*",3,"change","disabled"],[1,"action-buttons"],["type","button",1,"button","button-primary",3,"click"],[1,"content-wrapper"],[1,"card-wrapper"],[1,"protocols-section"],[3,"files"],["type","button",1,"add-icon","floating-icon",3,"click","tabIndex"],["role","button",1,"add"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24"],["stroke","white","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 5v14m-7-7h14"],[1,"card",3,"routerLink"],[1,"status-pill"],[1,"headline"],[1,"note"],[1,"category"],[1,"section-header"],[1,"protocol-list"],[1,"empty-state"],[1,"protocol-item"],[1,"protocol-info"],[1,"protocol-name"],[1,"protocol-meta"],[1,"separator"],["type","button",1,"button","button-secondary",3,"click"]],template:function(e,i){if(e&1){let c=F();a(0,"div",1)(1,"h2"),l(2),n(),a(3,"app-filter",2),h("filterChange",function(x){return j(c),P(i.filterChanged(x))}),n(),a(4,"label",3),ie(),a(5,"svg",4),b(6,"path",5),n()(),je(),a(7,"input",6,0),h("change",function(x){return j(c),P(i.onFileSelected(x))}),n(),a(9,"div",7)(10,"button",8),h("click",function(){return j(c),P(i.manageCategories())}),l(11),s(12,"translate"),n(),a(13,"button",8),h("click",function(){return j(c),P(i.generateProtocol())}),l(14),s(15,"translate"),n()(),a(16,"div",9),_(17,pt,3,0,"div",10),_(18,gt,7,4,"section",11),_(19,ft,1,1,"app-file-list",12),n(),a(20,"button",13),s(21,"translate"),h("click",function(){return j(c),P(i.addObject())}),a(22,"i",14),ie(),a(23,"svg",15),b(24,"path",16),n()()()()}if(e&2){let c;r(2),d((c=i.project())==null?null:c.name),r(),g("filter",i.filterData()),r(4),g("disabled",i.uploading()),r(4),v(" ",p(12,10,"projects.manageCategories")," "),r(3),v(" ",p(15,12,"protocols.generateProtocol")," "),r(3),C(i.filteredObjects().length>0?17:-1),r(),C(i.project()?18:-1),r(),C(i.files()?19:-1),r(),g("tabIndex",2),J("aria-label",p(21,14,"objects.add"))}},dependencies:[Ce,se,A,Ee,V],styles:["[_nghost-%COMP%]{display:block}.wrapper[_ngcontent-%COMP%]{padding:0 var(--space);width:100%;height:100%}@media screen and (max-width: 768px){.wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}}.category[_ngcontent-%COMP%]{text-decoration:overline;font-size:.85rem;color:#4a4a4a;font-weight:700}.card[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;gap:.25rem}.protocols-section[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;border-radius:12px;background:#fff;box-shadow:0 10px 30px -15px #0003}.protocols-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.protocols-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem}.protocol-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.protocol-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1.5rem;padding:1rem;border:1px solid #e5e5e5;border-radius:10px;background:#fafafa}.protocol-info[_ngcontent-%COMP%]{flex:1}.protocol-name[_ngcontent-%COMP%]{margin:0 0 .35rem;font-weight:600;font-size:1rem}.protocol-meta[_ngcontent-%COMP%]{margin:0;color:#666;font-size:.9rem;display:flex;flex-wrap:wrap;gap:.5rem}.separator[_ngcontent-%COMP%]{color:#aaa}.empty-state[_ngcontent-%COMP%]{margin:0;padding:1rem;border-radius:8px;background:#f2f4f7;color:#666}"],changeDetection:0})};var Zo=[{path:"",component:fe},{path:"tab/:id",component:xe}];export{Zo as ProjectsRoutes};
